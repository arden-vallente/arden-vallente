<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<sub-flow name="sys-sitetracker-api-get-site-subflow" doc:id="1495227b-4dac-45ff-9bbc-df132159451e" >
		<logger level="INFO" doc:name="START - Get Site" doc:id="2b6fbad7-d828-4ee3-81f7-530d5fc899a4" message="START - Get Site | ${sys.sitetracker.path.site} | Query Params: #[vars.queryParams]" category="${app.log.category}"/>
		<until-successful maxRetries="${retry.attempt.max}" doc:name="Until Succesful" doc:id="1da5fb72-cf6a-425c-98ee-0025d175a174" millisBetweenRetries="${retry.attempt.wait}">
			<try doc:name="Try" doc:id="4b2a1fcd-477b-435b-813f-5b86c6270a5e" >
				<http:request method="GET" doc:name="GET /sys-sitetracker-api/site" doc:id="060a84fb-1604-4995-990e-9c195603d540" config-ref="HTTP_Request_configuration_sys-sitetracker-api" path="${sys.sitetracker.path.site}" sendCorrelationId="ALWAYS">
					<error-mapping sourceType="HTTP:CONNECTIVITY" targetType="FS:CONNECTIVITY" />
					<http:headers ><![CDATA[#[output application/java
	---
	{
		"client-id" : p('sys.sitetracker.client.id'),
		"client-secret" : p('sys.sitetracker.client.secret'),
		"Content-Type": "application/json"
	}]]]></http:headers>
					<http:query-params ><![CDATA[#[vars.queryParams]]]></http:query-params>
				</http:request>
				<error-handler ref="system-error-handler" />
			</try>
		</until-successful>
		
		<logger level="INFO" doc:name="DEBUG - Get Site" doc:id="b302a529-5d74-4069-85a9-41136bd4b26c" message="DEBUG - Get Site Result: #[payload]" category="${app.log.category}" />
		<logger level="INFO" doc:name="END - Get Site" doc:id="44569dc7-c77e-4815-9a95-d02c6baa996d" message="END - Get Site | Site Result Count: #[sizeOf(payload.data)]" category="${app.log.category}"/>
	</sub-flow>
</mule>
